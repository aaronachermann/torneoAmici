<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario - Gestione Torneo degli Amici</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <style>
        /* Allineamento tabelle playoff */
        .playoff-table {
            margin-bottom: 2rem;
        }

        .playoff-table .table {
            table-layout: fixed;
            width: 100%;
        }

        .playoff-table .table th,
        .playoff-table .table td {
            vertical-align: middle;
            text-align: center;
            padding: 12px 8px;
        }

        /* Larghezze colonne fisse per consistenza */
        .playoff-table .table th:nth-child(1),
        .playoff-table .table td:nth-child(1) { width: 80px; }   /* Partita N° */

        .playoff-table .table th:nth-child(2),
        .playoff-table .table td:nth-child(2) { width: 70px; }   /* Orario */

        .playoff-table .table th:nth-child(3),
        .playoff-table .table td:nth-child(3) { width: 200px; }  /* Squadra 1 */

        .playoff-table .table th:nth-child(4),
        .playoff-table .table td:nth-child(4) { width: 200px; }  /* Squadra 2 */

        .playoff-table .table th:nth-child(5),
        .playoff-table .table td:nth-child(5) { width: 120px; }  /* Risultato */

        .playoff-table .table th:nth-child(6),
        .playoff-table .table td:nth-child(6) { width: 90px; }   /* Azioni */

        /* Per le finali con colonna extra (Lega e Piazzamento) */
        .finals-table .table th:nth-child(1),
        .finals-table .table td:nth-child(1) { width: 70px; }   /* Partita N° */

        .finals-table .table th:nth-child(2),
        .finals-table .table td:nth-child(2) { width: 60px; }   /* Orario */

        .finals-table .table th:nth-child(3),
        .finals-table .table td:nth-child(3) { width: 60px; }   /* Lega */

        .finals-table .table th:nth-child(4),
        .finals-table .table td:nth-child(4) { width: 180px; }  /* Squadra 1 */

        .finals-table .table th:nth-child(5),
        .finals-table .table td:nth-child(5) { width: 180px; }  /* Squadra 2 */

        .finals-table .table th:nth-child(6),
        .finals-table .table td:nth-child(6) { width: 110px; }  /* Piazzamento */

        .finals-table .table th:nth-child(7),
        .finals-table .table td:nth-child(7) { width: 100px; }  /* Risultato */

        .finals-table .table th:nth-child(8),
        .finals-table .table td:nth-child(8) { width: 80px; }   /* Azioni */

        /* Altezza minima uniforme per le righe */
        .playoff-table .table tbody tr,
        .finals-table .table tbody tr {
            height: 60px;
        }

        /* Sezioni semifinali con spacing uniforme */
        .semifinal-section {
            margin-bottom: 1.5rem;
        }

        .semifinal-section h5 {
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        /* Header delle card uniformi */
        .playoff-card .card-header {
            padding: 0.75rem 1.25rem;
            min-height: 3rem;
            display: flex;
            align-items: center;
        }

        .playoff-card .card-header h4 {
            margin: 0;
            font-size: 1.1rem;
        }

        /* Qualificazioni con stesse larghezze colonne */
        .qualification-table .table th:nth-child(1),
        .qualification-table .table td:nth-child(1) { width: 80px; }   /* Partita N° */

        .qualification-table .table th:nth-child(2),
        .qualification-table .table td:nth-child(2) { width: 70px; }   /* Orario */

        .qualification-table .table th:nth-child(3),
        .qualification-table .table td:nth-child(3) { width: 200px; }  /* Squadra 1 */

        .qualification-table .table th:nth-child(4),
        .qualification-table .table td:nth-child(4) { width: 200px; }  /* Squadra 2 */

        .qualification-table .table th:nth-child(5),
        .qualification-table .table td:nth-child(5) { width: 120px; }  /* Risultato */

        .qualification-table .table th:nth-child(6),
        .qualification-table .table td:nth-child(6) { width: 90px; }   /* Azioni */
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container position-relative">
            <a class="navbar-brand" href="{{ url_for('index') }}">Torneo degli Amici</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('teams') }}">Squadre</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('groups') }}">Gironi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('schedule') }}">Calendario</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('standings') }}">Classifiche</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('settings') }}">Settings</a>
                    </li>
                </ul>
            </div>
            
            <!-- LOGO IHC MALCANTONE AGGIUNTO -->
            <div class="navbar-logo">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="IHC Malcantone" />
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-info alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="d-flex justify-content-between align-items-center">
            <h1>Calendario Partite {{ tournament_dates.qualification_day1.date.year }}</h1>
            <div>
                <form method="post" class="d-inline">
                    <button type="submit" class="btn btn-primary">Genera Calendario Completo</button>
                </form>
                <!-- <form method="post" action="{{ url_for('reset_schedule') }}" class="d-inline ms-2">
                    <button type="submit" class="btn btn-danger">Azzera Calendario</button>
                </form> -->
            </div>
        </div>

        <!-- Sezione Qualificazioni -->
        <h2 class="mt-4" id="qualificazioni">Qualificazioni ({{ tournament_dates.qualification_day1.day_name_it }} e {{ tournament_dates.qualification_day2.day_name_it }}, {{ tournament_dates.qualification_day1.date.day }} e {{ tournament_dates.qualification_day2.date.day }} {{ tournament_dates.qualification_day1.month_name_it }} {{ tournament_dates.qualification_day1.date.year }})</h2>
        {% for date, matches in matches_by_date.items() %}
            {% set qual_matches = matches | selectattr("phase", "equalto", "group") | list %}
            {% if qual_matches|length > 0 %}
                <div class="card mt-4 playoff-card" id="qual-{{ date }}">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            {% if date == tournament_dates.qualification_day1.date.strftime('%Y-%m-%d') %}
                                {{ tournament_dates.qualification_day1.day_name_it }}, {{ date }}
                            {% elif date == tournament_dates.qualification_day2.date.strftime('%Y-%m-%d') %}
                                {{ tournament_dates.qualification_day2.day_name_it }}, {{ date }}
                            {% else %}
                                {{ date }}
                            {% endif %}
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive qualification-table">
                            <table class="table table-striped">
                                <thead>
                                    <tr> 
                                        <th>Partita N°</th>
                                        <th>Orario</th>
                                        <th>Squadra 1</th>
                                        <th>Squadra 2</th>
                                        <th>Risultato</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for match in qual_matches %}
                                        <tr id="match-{{ match.id }}">
                                            <td><strong>{{ match.get_match_number() }}</strong></td>
                                            <td>{{ match.time.strftime('%H:%M') }}</td>
                                            <td>{{ match.get_team1_display_name() }}</td>
                                            <td>{{ match.get_team2_display_name() }}</td>
                                            <td>
                                                {% if match.is_completed %}
                                                    <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">Non giocata</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        

        <!-- Sezione Playoff - Major League -->
        <h2 class="mt-4" id="playoff-major">Playoff - Major League</h2>
        {% for date, matches in matches_by_date.items() %}
            {% set major_matches = matches | selectattr("league", "equalto", "Major League") | selectattr("phase", "ne", "group") | selectattr("phase", "ne", "final") | list %}
            {% if major_matches|length > 0 %}
                <div class="card mt-4 playoff-card" id="major-{{ date }}">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            {{ date }}
                            {% set first_match = major_matches[0] %}
                            {% if first_match.phase == 'quarterfinal' %}
                                - Quarti di Finale
                            {% elif first_match.phase == 'semifinal' %}
                                - Semifinali
                            {% endif %}
                        </h4>
                    </div>
                    <div class="card-body">
                        {% if major_matches[0].phase == 'semifinal' %}
                            <!-- Raggruppamento semifinali -->
                            {% set consolation_matches = major_matches[:2] %}
                            {% set title_matches = major_matches[2:] %}
                            
                            <div class="semifinal-section">
                                <h5 class="text-warning mb-3">🥉 Semifinali 5°-8° posto</h5>
                                <div class="table-responsive playoff-table">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Partita N°</th>
                                                <th>Orario</th>
                                                <th>Squadra 1</th>
                                                <th>Squadra 2</th>
                                                <th>Risultato</th>
                                                <th>Azioni</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for match in consolation_matches %}
                                                <tr id="match-{{ match.id }}">
                                                    <td><strong>{{ match.get_match_number() }}</strong></td>
                                                    <td>{{ match.time.strftime('%H:%M') }}</td>
                                                    <td>{{ match.get_team1_display_name() }}</td>
                                                    <td>{{ match.get_team2_display_name() }}</td>
                                                    <td>
                                                        {% if match.is_completed %}
                                                            <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">Non giocata</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="semifinal-section">
                                <h5 class="text-primary mb-3">🏆 Semifinali 1°-4° posto</h5>
                                <div class="table-responsive playoff-table">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Partita N°</th>
                                                <th>Orario</th>
                                                <th>Squadra 1</th>
                                                <th>Squadra 2</th>
                                                <th>Risultato</th>
                                                <th>Azioni</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for match in title_matches %}
                                                <tr id="match-{{ match.id }}">
                                                    <td><strong>{{ match.get_match_number() }}</strong></td>
                                                    <td>{{ match.time.strftime('%H:%M') }}</td>
                                                    <td>{{ match.get_team1_display_name() }}</td>
                                                    <td>{{ match.get_team2_display_name() }}</td>
                                                    <td>
                                                        {% if match.is_completed %}
                                                            <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">Non giocata</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        {% else %}
                            <!-- Tabella normale per quarti di finale -->
                            <div class="table-responsive playoff-table">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Partita N°</th>
                                            <th>Orario</th>
                                            <th>Squadra 1</th>
                                            <th>Squadra 2</th>
                                            <th>Risultato</th>
                                            <th>Azioni</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for match in major_matches %}
                                            <tr id="match-{{ match.id }}">
                                                <td><strong>{{ match.get_match_number() }}</strong></td>
                                                <td>{{ match.time.strftime('%H:%M') }}</td>
                                                <td>{{ match.get_team1_display_name() }}</td>
                                                <td>{{ match.get_team2_display_name() }}</td>
                                                <td>
                                                    {% if match.is_completed %}
                                                        <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">Non giocata</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

        <!-- Sezione Playoff - Beer League -->
        <h2 class="mt-4" id="playoff-beer">Playoff - Beer League</h2>
        {% for date, matches in matches_by_date.items() %}
            {% set beer_matches = matches | selectattr("league", "equalto", "Beer League") | selectattr("phase", "ne", "group") | selectattr("phase", "ne", "final") | list %}
            {% if beer_matches|length > 0 %}
                <div class="card mt-4 playoff-card" id="beer-{{ date }}">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0">
                            {{ date }}
                            {% set first_match = beer_matches[0] %}
                            {% if first_match.phase == 'quarterfinal' %}
                                - Quarti di Finale
                            {% elif first_match.phase == 'semifinal' %}
                                - Semifinali
                            {% endif %}
                        </h4>
                    </div>
                    <div class="card-body">
                        {% if beer_matches[0].phase == 'semifinal' %}
                            <!-- Raggruppamento semifinali Beer League -->
                            {% set consolation_matches = beer_matches[:2] %}
                            {% set title_matches = beer_matches[2:] %}
                            
                            <div class="semifinal-section">
                                <h5 class="text-warning mb-3">🥉 Semifinali 5°-8° posto</h5>
                                <div class="table-responsive playoff-table">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Partita N°</th>
                                                <th>Orario</th>
                                                <th>Squadra 1</th>
                                                <th>Squadra 2</th>
                                                <th>Risultato</th>
                                                <th>Azioni</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for match in consolation_matches %}
                                                <tr id="match-{{ match.id }}">
                                                    <td><strong>{{ match.get_match_number() }}</strong></td>
                                                    <td>{{ match.time.strftime('%H:%M') }}</td>
                                                    <td>{{ match.get_team1_display_name() }}</td>
                                                    <td>{{ match.get_team2_display_name() }}</td>
                                                    <td>
                                                        {% if match.is_completed %}
                                                            <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">Non giocata</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="semifinal-section">
                                <h5 class="text-primary mb-3">🏆 Semifinali 1°-4° posto</h5>
                                <div class="table-responsive playoff-table">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Partita N°</th>
                                                <th>Orario</th>
                                                <th>Squadra 1</th>
                                                <th>Squadra 2</th>
                                                <th>Risultato</th>
                                                <th>Azioni</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for match in title_matches %}
                                                <tr id="match-{{ match.id }}">
                                                    <td><strong>{{ match.get_match_number() }}</strong></td>
                                                    <td>{{ match.time.strftime('%H:%M') }}</td>
                                                    <td>{{ match.get_team1_display_name() }}</td>
                                                    <td>{{ match.get_team2_display_name() }}</td>
                                                    <td>
                                                        {% if match.is_completed %}
                                                            <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">Non giocata</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        {% else %}
                            <!-- Tabella normale per quarti di finale Beer League -->
                            <div class="table-responsive playoff-table">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Partita N°</th>
                                            <th>Orario</th>
                                            <th>Squadra 1</th>
                                            <th>Squadra 2</th>
                                            <th>Risultato</th>
                                            <th>Azioni</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for match in beer_matches %}
                                            <tr id="match-{{ match.id }}">
                                                <td><strong>{{ match.get_match_number() }}</strong></td>
                                                <td>{{ match.time.strftime('%H:%M') }}</td>
                                                <td>{{ match.get_team1_display_name() }}</td>
                                                <td>{{ match.get_team2_display_name() }}</td>
                                                <td>
                                                    {% if match.is_completed %}
                                                        <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">Non giocata</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

        <!-- Sezione Finali Unificate -->
        <h2 class="mt-4" id="finali">Finali - {{ tournament_dates.finals.day_name_it }} {{ tournament_dates.finals.date.day }} {{ tournament_dates.finals.month_name_it }}</h2>
        {% for date, matches in matches_by_date.items() %}
            {% set final_matches = matches | selectattr("phase", "equalto", "final") | list %}
            {% if final_matches|length > 0 %}
                <div class="card mt-4 playoff-card" id="finali-{{ date }}">
                    <div class="card-header bg-dark text-white">
                        <h4 class="mb-0">
                            🏆 Finali {{ date }} - Piazzamenti
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <span class="badge bg-success me-2">■ Major League</span>
                            <span class="badge bg-warning text-dark">■ Beer League</span>
                        </div>
                        
                        <div class="table-responsive finals-table">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Partita N°</th>
                                        <th>Orario</th>
                                        <th>Lega</th>
                                        <th>Squadra 1</th>
                                        <th>Squadra 2</th>
                                        <th>Piazzamento</th>
                                        <th>Risultato</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for match in final_matches | sort(attribute='time') %}
                                        <tr {% if match.league == 'Major League' %}class="table-success"{% else %}class="table-warning"{% endif %} id="match-{{ match.id }}">
                                            <td><strong>{{ match.get_match_number() }}</strong></td>
                                            <td>{{ match.time.strftime('%H:%M') }}</td>
                                            <td>
                                                {% if match.league == 'Major League' %}
                                                    <span class="badge bg-success">ML</span>
                                                {% else %}
                                                    <span class="badge bg-warning text-dark">BL</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ match.get_team1_display_name() }}</td>
                                            <td>{{ match.get_team2_display_name() }}</td>
                                            <td>
                                                {% set match_number = match.get_match_number() %}
                                                {% if match_number in [41, 42] %}
                                                    <span class="badge bg-secondary">7°/8° posto</span>
                                                {% elif match_number in [43, 44] %}
                                                    <span class="badge bg-warning text-dark">5°/6° posto</span>
                                                {% elif match_number in [45, 46] %}
                                                    <span class="badge bg-info">3°/4° posto</span>
                                                {% elif match_number in [47, 48] %}
                                                    <span class="badge bg-primary">🥇 1°/2° posto</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if match.is_completed %}
                                                    <span class="badge bg-success">{{ match.team1_score }} - {{ match.team2_score }}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">Non giocata</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <a href="{{ url_for('match_detail', match_id=match.id) }}?return_anchor=match-{{ match.id }}" class="btn btn-sm btn-info">Dettagli</a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}

        <!-- Messaggio se non ci sono partite -->
        {% if not matches_by_date %}
            <div class="alert alert-info mt-4">
                <h4><i class="fas fa-calendar-alt"></i> Nessuna partita programmata</h4>
                <p>Il calendario del torneo non è ancora stato generato.</p>
                <p><strong>Per generare il calendario:</strong></p>
                <ol>
                    <li>Assicurati che tutte le 16 squadre siano registrate</li>
                    <li>Verifica che ogni girone abbia esattamente 4 squadre</li>
                    <li>Clicca su "Genera Calendario Completo"</li>
                </ol>
            </div>
        {% endif %}

        <!-- Statistiche partite -->
        {% if matches_by_date %}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h4 class="mb-0">📊 Statistiche Calendario</h4>
                        </div>
                        <div class="card-body">
                            {% set all_matches = [] %}
                            {% for date, matches in matches_by_date.items() %}
                                {% set _ = all_matches.extend(matches) %}
                            {% endfor %}
                            
                            {% set total_matches = all_matches|length %}
                            {% set completed_matches = all_matches|selectattr("is_completed")|list|length %}
                            {% set qualification_matches = all_matches|selectattr("phase", "equalto", "group")|list|length %}
                            {% set playoff_matches = total_matches - qualification_matches %}
                            
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <h5 class="text-primary">{{ total_matches }}</h5>
                                    <small>Partite Totali</small>
                                </div>
                                <div class="col-md-3">
                                    <h5 class="text-success">{{ completed_matches }}</h5>
                                    <small>Partite Giocate</small>
                                </div>
                                <div class="col-md-3">
                                    <h5 class="text-info">{{ qualification_matches }}</h5>
                                    <small>Qualificazioni</small>
                                </div>
                                <div class="col-md-3">
                                    <h5 class="text-warning">{{ playoff_matches }}</h5>
                                    <small>Playoff</small>
                                </div>
                            </div>
                            
                            {% if total_matches > 0 %}
                                <div class="progress mt-3">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         style="width: {{ (completed_matches / total_matches * 100)|round }}%">
                                        {{ (completed_matches / total_matches * 100)|round }}% completato
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

    </div>

    

    <footer class="bg-dark text-white py-3 mt-auto">
        <div class="container text-center">
            <p>© Torneo degli Amici dello Skater - Memorial Marzio Camponovo</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script per smooth scroll agli anchor -->
    <script>
        // Smooth scroll quando si torna da una pagina di dettaglio
        document.addEventListener('DOMContentLoaded', function() {
            // Se c'è un hash nell'URL, scrolla verso quell'elemento
            if (window.location.hash) {
                const element = document.querySelector(window.location.hash);
                if (element) {
                    setTimeout(() => {
                        element.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                        // Evidenzia brevemente la riga
                        element.style.backgroundColor = '#ffeb3b';
                        setTimeout(() => {
                            element.style.backgroundColor = '';
                        }, 2000);
                    }, 100);
                }
            }
        });
    </script>
</body>
</html>